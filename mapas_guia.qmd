---
title: "Inicio"
subtitle: "Portafolio de Rafael Reyes"
format:
  html:
    toc: true
    toc-depth: 2
    code-fold: true
    highlight-style: dracula
execute:
  echo: false
  warning: false
  message: false
  freeze: auto
---

```{r}
#| label: mapa-interactivo
#| echo: false
#| warning: false
#| message: false

library(here)
library(sf)
library(geodata)
library(leaflet)

dir.create(here("data"), showWarnings = FALSE)
gpkg <- here("data", "peru_deps_lvl1.gpkg")

if (!file.exists(gpkg)) {
  peru_lvl1 <- geodata::gadm("PER", level = 1, path = here("data"))
  deps <- sf::st_as_sf(peru_lvl1)
  sf::st_write(deps, gpkg, delete_dsn = TRUE)
}

deps <- sf::st_read(gpkg, quiet = TRUE)
deps_view <- sf::st_simplify(deps, dTolerance = 0.03, preserveTopology = TRUE)
deps_wgs <- sf::st_transform(deps_view, 4326)

set.seed(1)
deps_wgs$montoviable <- runif(nrow(deps_wgs), 10, 100)

pal <- colorNumeric(palette = "viridis", domain = deps_wgs$montoviable)

leaflet(deps_wgs) |>
  addProviderTiles("CartoDB.Positron") |>
  addPolygons(
    fillColor = ~pal(montoviable),
    color = "#444444", weight = 1, opacity = 1,
    fillOpacity = 0.7,
    label = ~NAME_1,
    popup = ~paste0(
      "<b>Departamento:</b> ", NAME_1, "<br>",
      "<b>Monto viable (M):</b> ", round(montoviable, 1)
    )
  ) |>
  addLegend("bottomright", pal = pal, values = ~montoviable,
            title = "Monto viable (M)")

```

